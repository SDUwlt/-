**Project1: SM4软件实现与优化**

---

**攻击原理**

本项目探索了SM4软件实现中的两种常见优化方式（T-Table和SIMD并行），同时揭示了高性能实现可能引入的缓存攻击风险：

- **T-Table攻击**：T-Table优化将线性变换融合入SBox查表，通过大表查找提高加密速度。然而，由于查表操作依赖明文和密钥，容易受到缓存侧信道攻击（如DJB提出的cache timing attack）。
- **SIMD并行处理**：使用SIMD寄存器（如SSE、AVX）对多个数据块同时加密，显著提升吞吐量。虽然SIMD优化本身不引入新攻击面，但在与T-Table结合使用时仍需注意数据访问模式的一致性。

---

**代码分析**

项目实现了以下三个SM4版本：

1. **基础版实现**：
   - 遵循国密SM4标准结构。
   - 使用C语言实现了32轮迭代、SBox查表与线性变换。
   - 优点：结构清晰，安全性强。
   - 缺点：加密效率较低，约30.7 cycles/byte。

2. **T-Table优化版**：
   - 构造四张8×32位查找表，融合SBox与线性变换（L(T(x))）。
   - 优点：显著减少循环内计算量，提高速度。
   - 缺点：引入缓存相关攻击风险。
   - 实测加速比：单块加密约提速 1.5×~2×。

3. **T-Table + SIMD优化版（2-block并行）**：
   - 使用SSE/SSSE3指令 (`__m128i`) 并行加密两个数据块。
   - 结构不变，仅将每轮加密逻辑向量化。
   - 优点：吞吐量大幅提升，适用于批量加密场景。
   - 缺点：代码复杂性提高。
   - 实测加速比：基础版约提速至 2.5×~3×。

---

**运行结果**

以Intel x86_64 + SSE2/SSSE3平台为测试环境，对比如下（数据为估算值，单位：cycles/byte）：

| 实现版本              | 加密块数 | 平均耗时（cycles/byte） | 提速比（vs基础版） |
|-----------------------|----------|---------------------------|---------------------|
| 基础实现（无优化）    | 1        | 30.7                      | 1×                  |
| T-Table优化           | 1        | 19.9                      | ~1.54×              |
| SIMD并行（2块）       | 2        | 13.8                      | ~2.23×              |
| T-Table + SIMD（2块） | 2        | 11.2                      | ~2.74×              |

输出示例（2块加密）：

<img width="979" height="102" alt="image" src="https://github.com/user-attachments/assets/131d48a0-6ee9-47d2-97ee-b151119f6320" />
